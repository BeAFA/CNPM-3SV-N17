{% extends 'layout/base.html' %}
{% block content %}

<div class="container-fluid mt-4 px-4">

<div class="card">
<div class="card-body">

<h3 class="mb-4">Quản lý tài khoản</h3>

<!-- ================= FILTER ROLE ================= -->
<div class="row mb-4">
    <div class="col-md-4">
        <select id="roleFilter" class="form-control" onchange="filterRole()">
            <option value="ALL">Tất cả</option>
            <option value="ADMIN">Admin</option>
            <option value="NHASI">Nha sĩ</option>
            <option value="KETOAN">Kế toán</option>
            <option value="KHACHHANG">Khách hàng</option>
        </select>
    </div>
</div>

<!-- ================= BẢNG TÀI KHOẢN ================= -->
<table class="table table-bordered">
<thead class="table-light">
<tr>
    <th>Họ tên</th>
    <th>Email</th>
    <th>Vai trò</th>
    <th>Thao tác</th>
</tr>
</thead>
<tbody>
{% for tk in accounts %}
<tr class="role-row" data-role="{{ tk.Role.name }}">
    <td>{{ tk.nguoi_dung.HoVaTen }}</td>
    <td>{{ tk.Email }}</td>
    <td>{{ tk.Role.name }}</td>
    <td>
        <a href="/admin/accounts/delete/{{ tk.id }}"
           class="btn btn-sm btn-danger"
           onclick="return confirm('Xóa tài khoản này?')">
           Xóa
        </a>
    </td>
</tr>
{% endfor %}
</tbody>
</table>

<hr>

<!-- ================= FORM THÊM TÀI KHOẢN ================= -->
<h4 class="mt-4">Thêm tài khoản</h4>

<form method="post" action="/admin/accounts/add">

<input type="hidden" name="role" id="selectedRole" value="KHACHHANG">

<div class="row">

     <div class="col-md-4">
        <input type="text" name="hoten" class="form-control" placeholder="Họ và tên" required>
    </div>


    <div class="col-md-3">
        <input type="email" name="email" class="form-control" placeholder="Email" required>
    </div>

    <div class="col-md-3">
        <input type="password" name="password" class="form-control" placeholder="Mật khẩu" required>
    </div>

    <div class="col-md-3">
        <button class="btn btn-success w-100">
            Thêm tài khoản
        </button>
    </div>

</div>
</form>

</div>
</div>
</div>

<script>
function filterRole() {
    let role = document.getElementById("roleFilter").value;
    document.getElementById("selectedRole").value = role;

    let rows = document.querySelectorAll(".role-row");

    rows.forEach(row => {
        if (role === "ALL" || row.dataset.role === role) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
}
</script>

{% endblock %}
